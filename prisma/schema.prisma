generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Team {
  id        String        @id @default(uuid())
  name      String        @unique
  shortName String        @unique
  coach     String
  captain   String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  innings   Innings[]
  homeA     Match[]       @relation("teamA")
  awayB     Match[]       @relation("teamB")
  wins      MatchResult[] @relation("winnerTeam")
  players   Player[]
  rankings  Ranking[]
  standing  Standing?
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Player {
  id                String        @id @default(uuid())
  name              String
  role              String
  battingStyle      String?
  bowlingStyle      String?
  teamId            String
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  leaderboards      Leaderboard[]
  playerOfMatch     MatchResult[]
  team              Team          @relation(fields: [teamId], references: [id])
  stats             PlayerStats[]
  battingDismissals Wicket[]      @relation("batsman")
  bowlingWickets    Wicket[]      @relation("bowler")
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Match {
  id         String        @id @default(uuid())
  title      String
  venue      String
  tournament String?
  status     String
  score      String        @default("0/0")
  overs      String        @default("0.0")
  runRate    Float         @default(0)
  teamAId    String
  teamBId    String
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  commentary Commentary[]
  innings    Innings[]
  teamA      Team          @relation("teamA", fields: [teamAId], references: [id])
  teamB      Team          @relation("teamB", fields: [teamBId], references: [id])
  result     MatchResult?
  stats      PlayerStats[]
  schedule   Schedule?
  wickets    Wicket[]
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Commentary {
  id        String   @id @default(uuid())
  matchId   String
  over      Int
  ball      Int
  runs      String
  text      String
  createdAt DateTime @default(now())
  match     Match    @relation(fields: [matchId], references: [id])
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Innings {
  id            String        @id @default(uuid())
  matchId       String
  teamId        String
  inningsNumber Int
  runs          Int
  wickets       Int
  overs         Float
  createdAt     DateTime      @default(now())
  match         Match         @relation(fields: [matchId], references: [id])
  team          Team          @relation(fields: [teamId], references: [id])
  stats         PlayerStats[]
  wicketsData   Wicket[]

  @@unique([matchId, inningsNumber])
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model PlayerStats {
  id           String   @id @default(uuid())
  playerId     String
  matchId      String
  inningsId    String?
  runs         Int      @default(0)
  ballsFaced   Int      @default(0)
  fours        Int      @default(0)
  sixes        Int      @default(0)
  overs        Float?
  runsConceded Int?
  wickets      Int      @default(0)
  createdAt    DateTime @default(now())
  innings      Innings? @relation(fields: [inningsId], references: [id])
  match        Match    @relation(fields: [matchId], references: [id])
  player       Player   @relation(fields: [playerId], references: [id])

  @@unique([playerId, matchId])
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Wicket {
  id        String   @id @default(uuid())
  matchId   String
  inningsId String
  batsmanId String
  bowlerId  String
  over      Int
  ball      Int
  kind      String
  createdAt DateTime @default(now())
  batsman   Player   @relation("batsman", fields: [batsmanId], references: [id])
  bowler    Player   @relation("bowler", fields: [bowlerId], references: [id])
  innings   Innings  @relation(fields: [inningsId], references: [id])
  match     Match    @relation(fields: [matchId], references: [id])
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model MatchResult {
  id              String   @id @default(uuid())
  matchId         String   @unique
  winnerTeamId    String?
  playerOfMatchId String?
  resultType      String
  summary         String?
  createdAt       DateTime @default(now())
  match           Match    @relation(fields: [matchId], references: [id])
  playerOfMatch   Player?  @relation(fields: [playerOfMatchId], references: [id])
  winnerTeam      Team?    @relation("winnerTeam", fields: [winnerTeamId], references: [id])
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Leaderboard {
  id        String   @id @default(uuid())
  type      String
  value     Int
  playerId  String
  createdAt DateTime @default(now())
  player    Player   @relation(fields: [playerId], references: [id])

  @@unique([playerId, type])
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Ranking {
  id     String @id @default(uuid())
  teamId String
  type   String
  rating Int
  team   Team   @relation(fields: [teamId], references: [id])

  @@unique([teamId, type])
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Standing {
  id     String @id @default(uuid())
  teamId String @unique
  played Int
  won    Int
  lost   Int
  points Int
  nrr    Float
  team   Team   @relation(fields: [teamId], references: [id])
}

/// /////////////////////////////////////////////
/// /////////////////////////////////////////////
model Schedule {
  id      String   @id @default(uuid())
  matchId String   @unique
  date    DateTime
  match   Match    @relation(fields: [matchId], references: [id])
}
